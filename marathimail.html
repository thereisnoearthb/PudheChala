<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pudhe Chala: Email petition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <style>
      body { background-color: white; color: black; padding-top: 1rem; padding-bottom: 1rem; }
      .container { max-width: 800px; }
      .btn-custom-primary { background-color: #2e4989; border-color: #2e4989; color: white; }
      .btn-custom-primary:hover, .btn-custom-primary:focus { background-color: #1e3a75; border-color: #1e3a75; color: white; }
      .btn-custom-secondary { background-color: #dfd3b9; border-color: #dfd3b9; color: black; }
      .btn-custom-secondary:hover, .btn-custom-secondary:focus { background-color: #c9bfa5; border-color: #c9bfa5; color: black; }
      .btn.disabled, .btn:disabled, fieldset:disabled .btn { pointer-events: none; opacity: 0.65; }
      .email-preview { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 1.5rem; margin-top: 1rem; border-radius: 0.375rem; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; max-height: 50vh; overflow-y: auto; }
      h5, h6 { color: #2e4989; }
      #email-details p { margin-bottom: 0.5rem; word-wrap: break-word; }
    </style>
</head>
<body>
    <div class="container">
      <h5 class="mb-3 text-center">Email Preview & Actions</h5>
      <p class="text-center text-muted small">Clicking on 'Send Mail' will open your email app.
        <br>
         If your email app doesn't open correctly, please use the copy button.</p>
      <div class="text-center mb-4">
        <a id="send" href="#" target="_blank" class="btn btn-custom-primary btn-lg me-2 disabled" role="button" title="Generating link...">
          <i class="bi bi-send"></i> Send Mail
        </a>
        <button id="copy" class="btn btn-custom-secondary me-2" type="button">
          <i class="bi bi-clipboard"></i> Copy Email Content
        </button>
      </div>
      <h6>Email Details:</h6>
      <div id="email-details" class="mb-3">
        <p><strong>To:</strong> <span id="preview-to">(Generating...)</span></p>
        <p id="cc-line" style="display: none;"><strong>Cc:</strong> <span id="preview-cc"></span></p>
        <p id="bcc-line" style="display: none;"><strong>Bcc:</strong> <span id="preview-bcc"></span></p>
        <p><strong>Subject:</strong> <span id="preview-subject">(Generating...)</span></p>
      </div>
      <h6>Email Body Preview:</h6>
      <div id="email-preview" class="email-preview">(Generating...)</div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
      // --- Embedded Mail Generation Script START ---
      
      const TO_ADDRESS = "transport@bestundertaking.com,office.mcmcr@mcgm.gov.in";
      const CC_ADDRESS = "";
      const BCC_ADDRESS = "solidarity@thereisnoearthb.com";
      const SUBJECT_LINES = ["मुंबईतील बेस्ट बससेवा सुधारण्यासाठी आणि बसांची संख्या वाढवण्याबाबत विनंती"];
      const PARA1_OPTIONS = ["आदरपूर्वक,\nमुंबई ही भारतातील सर्वात जास्त लोकसंख्या असलेली शहर आहे आणि बेस्ट दररोज सुमारे ३५ लाख प्रवाशांची वाहतूक करते. मात्र, सध्या बेस्टकडे असलेल्या बससंख्येत मोठी घट झाल्यामुळे प्रवाशांवर प्रचंड ताण येत आहे. बेस्टने ३,१९५ वरून २,९१५ बसपर्यंत बस संख्या कमी केली आहे – म्हणजे जवळपास ९% घट. त्यामुळे केवळ बसची वारंवारता कमी झाली आहे असे नाही, तर सेवा गुणवत्ताही खालावली आहे. सार्वजनिक वाहतूक ही लाखो लोकांसाठी स्वस्त आणि महत्त्वाची आहे, त्यामुळे ही घसरण अत्यंत चिंतेची बाब आहे.\n\nAECOM या संस्थेच्या २०१८ मध्ये केलेल्या सर्वेक्षणात १,००० मुंबईकरांपैकी बहुतांश लोक सार्वजनिक वाहतूक विश्वसनीय वाटत नाही असे म्हणाले होते आणि ७५% लोकांनी तिचा वापर करणे अधिक तणावदायक होत असल्याचे नमूद केले होते."];
      const PARA2_OPTIONS = ["मुंबईकर नागरिक म्हणून आम्ही पुढील दोन मुख्य मागण्या ठेवतो:\n\n1. बेस्टने सर्व बसेसची पूर्ण मालकी घेऊन खासगीकरण टप्प्याटप्प्याने थांबवावे आणि संचालन क्षमता मजबूत करावी.\n\n\n2. अशी सार्वजनिक वाहतूक व्यवस्था उभारावी जी केवळ सक्षम, डिजिटल जाणकार लोकांसाठीच नव्हे, तर प्रत्येकासाठी उपयुक्त असेल.\n\n\n\nअ. आमच्या मागण्या पुढील मुद्द्यांवर आधारित आहेत:\n\n१. कार्यक्षमतेसंदर्भात\n\nमुंबईत जेव्हा ३,२८४ बस होत्या, तेव्हा दर १ लाख लोकसंख्येमागे १५ बस होत्या. हा आकडा जागतिक मानदंड (५० ते १२० बस प्रति लाख) च्या तुलनेत अत्यल्प आहे. सध्या ही स्थिती आणखी वाईट झाली आहे.\n\n\"वेट लीज\" प्रणालीचा त्रास: बेस्ट सध्या वेट लीजवर खासगी बस व चालक घेत असून, ही प्रणाली प्रवासी सुरक्षितता, कर्मचारी हक्क, आणि सेवा गुणवत्ता यांना धोका निर्माण करते. कुरळा अपघात (डिसेंबर २०२४) हेच दाखवते.\n\nखासगी ड्रायव्हर/कंत्राटदार तक्रारी: ड्रायव्हर कोटे पूर्ण करण्यासाठी थांबे चुकवतात, कंडक्टर नसल्याने तिकीटासाठी पुन्हा रांगा, प्रवासात उशीर व गैरसोयी.\n\nआर्थिक अनियमितता: खासगी विकसकांकडून जमीन दिली असूनही ₹३०० कोटी मिळालेले नाहीत. बेस्टची मालमत्ता खासगी हितसंबंधांकरिता वापरली जाते.\n\n\n२. सार्वजनिक वाहतुकीवरील गुंतवणुकीचा अभाव\n\n२०२४-२५ मध्ये, मुंबई महापालिकेने ₹६०,००० कोटी खर्च रस्ते व पूलांवर केला, पण बेस्टकडे दुर्लक्ष केले. सार्वजनिक वाहतूक म्हणजे सर्वांसाठी समान संधी, ही विसरली गेली आहे.\n\n३. बस संख्येतील घट\n\n२०१९ मध्ये, बेस्टने ३,३३३ बसेस टिकवण्याचे आश्वासन दिले होते. पण आता स्वतःच्या मालकीच्या बस केवळ ९२० उरल्या असून, २०२६ पर्यंत २२९ वर येणार आहेत. संपूर्ण मुंबईत सध्या केवळ २,८५५ बस असून, दर बसमागे दररोज १,२०० पेक्षा अधिक प्रवासी येतात – जे अशक्य आहे. ही परिस्थिती त्वरित बदलण्याची गरज आहे.\n\n\n\nब. सुलभता\n\nबेस्ट सेवा आज वृद्धासाठी, महिलांसाठी, दिव्यांगांसाठी आणि डिजिटल साक्षर नसलेल्या लोकांसाठी दुर्गम झाली आहे.\n\nअ‍ॅप्स विश्वासार्ह राहिलेली नाहीत. स्टॉपवर माहिती नाही.\n\nव्हीलचेअर सुविधा, ब्रेल मॅप्स, आणि दृष्टिहीन वा न्यूरोडायव्हर्जंट व्यक्तींसाठी कुठलीही सोय नाही.\n\nमहिलांना स्वच्छतागृहांची अनुपलब्धता, साफसफाईचा अभाव  सर्व मोठ्या अडचणी.\n\n\n\n\nक. समावेशकता\n\nगरीब, वृद्ध, महिलांना सुरक्षित व स्वस्त वाहतूक मिळाली पाहिजे.\n\nमहिला कामासाठी, शिक्षणासाठी सार्वजनिक वाहतुकीवर अवलंबून असतात – पण असुरक्षिततेमुळे व दरवाढीमुळे त्यांचा सहभाग कमी होतो.\n\n\n\nआमच्या ठाम मागण्या:\n\n1. बेस्टने खासगी बस पूर्णपणे टप्प्याटप्प्याने बंद करून मालकीखाली घ्याव्यात व क्षमता वाढवावी.\n\n\n2. २०२५ मध्ये करण्यात आलेली दरवाढ त्वरित मागे घ्यावी.\n\n\n3. बेस्टला सरकारकडून थेट निधी द्यावा. उत्पन्न पुन्हा सेवेतच गुंतवावे.\n\n\n4. २०१९ च्या MOU नुसार बससंख्या वाढवावी.\n\n\n5. वेट-लीज प्रणाली टप्प्याटप्प्याने संपवावी – हक्क, सुरक्षा, व स्थिरता यासाठी.\n\n\n6. डेपो जमिनी खासगीकरण न करता बससाठी वापराव्यात.\n\n\n7. वार्षिक अहवाल प्रकाशित करावा – बससंख्या, खर्च, सुधारणा याबाबत पारदर्शकता हवी.\n\n\n\nसर्वांसाठी व्यवस्था तयार करणे\n\nप्रत्येक बसथांब्यावर स्पष्ट रंग-निहाय मार्गनकाशे लावावेत.\n\nदिशादर्शक नकाशे ब्रेलमध्ये, इंग्रजी, मराठी व हिंदीमध्ये द्यावेत.\n\nप्रत्येक थांब्यावर बाक, सावली, चार्जिंग पॉइंट्स असावेत.\n\nमहिलांसाठी स्वच्छतागृहे असावीत.\n\nनव्या बसमध्ये व्हीलचेअर रॅम्प असावा व चालक-वाहक यांना सहानुभूतीपूर्वक प्रशिक्षण द्यावे.\n\nप्रवाशांच्या तक्रारींसाठी हेल्पलाईन सुरू करावी.\n\nतेजस्विनी (Ladies Special) बसेसची संख्या वाढवावी.\n\nमहिलांसाठी व ट्रान्सजेंडर प्रवाशांसाठी Ladies Special बसेस मोफत कराव्यात.\n\nमहिलांना, विद्यार्थ्यांना, वृद्धांना व दिव्यांगांना प्रवास सवलत लागू करावी."];
      const PARA3_OPTIONS = ["आशा आहे की आपण ह्या मागण्यांकडे गांभीर्याने लक्ष देऊन सकारात्मक निर्णय घ्याल."];
      const SIGNING_OFF_OPTIONS = ["आपला विश्वासू, एक चिंताग्रस्त पण जागरूक नागरिक"];

      // --- Use actual newline characters internally for JS logic ---
      const LINE_BREAK = "\n";
      const DOUBLE_LINE_BREAK = "\n\n";
    
      
      let mailtoLink = "";
      let copyText = ""; // Body only for preview/copy
      let selectedSubject = "";

      function getRandomElement(arr) {
        // Ensure arr is an array and not empty before accessing length
        if (!Array.isArray(arr) || arr.length === 0) return "";
        return arr[Math.floor(Math.random() * arr.length)];
      }

      function escapeHtmlForDisplay(unsafe) {
        if (typeof unsafe !== "string") return "";
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      function prepareMail() {
        const sendLink = document.getElementById("send");

        try {
          selectedSubject = getRandomElement(SUBJECT_LINES);
          const selectedPara1 = getRandomElement(PARA1_OPTIONS);
          const selectedPara2 = getRandomElement(PARA2_OPTIONS);
          const selectedPara3 = getRandomElement(PARA3_OPTIONS);
          const selectedSignoff = getRandomElement(SIGNING_OFF_OPTIONS);

          // --- Construct body using actual newlines ---
          const bodyForMailto = [
            selectedPara1,
            selectedPara2,
            selectedPara3,
            selectedSignoff,
          ].filter(p => typeof p === 'string' && p.length > 0) // Filter out potential empty strings/undefined
           .join(DOUBLE_LINE_BREAK); // Join paragraphs with internal newlines

          // --- Construct mailto link (URLSearchParams will encode \n correctly) ---
          const params = new URLSearchParams();
          // Only add params if they have a value
          if (CC_ADDRESS) params.append("cc", CC_ADDRESS);
          if (BCC_ADDRESS) params.append("bcc", BCC_ADDRESS);
          if (selectedSubject) params.append("subject", selectedSubject);
          if (bodyForMailto) params.append("body", bodyForMailto); // Let URLSearchParams handle encoding 


          // Platform Specific Adjustments (Example for iOS if needed later)
          let finalQueryString = params.toString();
          finalQueryString = finalQueryString.replace(/\+/g, '%20');

          // Platform Detection
					const userAgent = navigator.userAgent || navigator.vendor || window.opera;
					const platformNavigator = navigator.platform || ""; // For OS-level platform string

					let detectedSystem = "Unknown";
					let mailtoEncodingProfile = "standard"; // Profile to decide encoding: 'ios_specific' or 'standard'

					// iOS Detection Logic
					// 1. Check navigator.platform for direct iOS device strings (most reliable if available)
					if (/iPad|iPhone|iPod/.test(platformNavigator)) {
						detectedSystem = "iOS";
						mailtoEncodingProfile = "ios_specific";
					}
					// 2. Check userAgent for standard iOS device strings
					else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) { // !window.MSStream helps avoid some Windows Phone false positives
						detectedSystem = "iOS";
						mailtoEncodingProfile = "ios_specific";
					}
					// 3. Check for "Macintosh" + "Mobile" in userAgent (common for iPads in desktop mode/emulators)
					else if (/Macintosh/.test(userAgent) && /Mobile/.test(userAgent)) {
						detectedSystem = "iOS";
						mailtoEncodingProfile = "ios_specific";
					}
					// 4. Check for "Macintosh" userAgent with multi-touch capability (another iPad desktop mode/emulator indicator)
					else if (/Macintosh/.test(userAgent) && navigator.maxTouchPoints && navigator.maxTouchPoints > 1) {
						detectedSystem = "iOS";
						mailtoEncodingProfile = "ios_specific";
					}
					// macOS Detection (ensure it's not an iPad already identified above)
					else if ((/Macintosh/.test(userAgent) || /MacIntel/.test(platformNavigator) || /MacPPC/.test(platformNavigator) || /Mac68K/.test(platformNavigator))) {
						detectedSystem = "macOS";
						mailtoEncodingProfile = "standard";
					}
					// Android Detection
					else if (/android/i.test(userAgent)) {
						detectedSystem = "Android";
						mailtoEncodingProfile = "standard"; // Android is generally robust
					}
					// Windows Detection
					else if (/Win/.test(platformNavigator)) {
						detectedSystem = "Windows";
						mailtoEncodingProfile = "standard";
					}
					// Linux Desktop Detection
					else if (/Linux/.test(platformNavigator) && !/android/i.test(userAgent)) { // Exclude Android's Linux
						detectedSystem = "Linux";
						mailtoEncodingProfile = "standard";
					}
					// If still "Unknown", it might be a less common OS. 'standard' is a safe default.
					console.log("Detected System:", detectedSystem);
					console.log("Using mailto encoding profile:", mailtoEncodingProfile);

					// Apply encoding adjustments based on the profile
					if (mailtoEncodingProfile === "ios_specific") {
						console.log("Applying iOS specific mailto link generation strategy.");
						finalQueryString = finalQueryString.replace(/%0A/g, '%0D%0A');
						console.log("iOS: Converted newlines from %0A to %0D%0A for better compatibility.");
					}
					
					else if (mailtoEncodingProfile === "standard") {
						console.log("Applying standard mailto link generation strategy for ", detectedSystem);
					}
					// finalQueryString is now potentially adjusted based on the platform.

					if(mailtoLink.length>1998)
						console.warn("mailto too long for Chrome: " + mailtoLink.length +" chars");
					else
						console.log("mailto length OK: "+ mailtoLink.length +" chars");

          if (TO_ADDRESS) {
             // Encode TO addresses individually, then join
             const encodedTo = TO_ADDRESS.split(",")
              .map(e => e.trim()) // Trim whitespace first
              .filter(e => e)     // Remove empty entries
              .map(e => encodeURIComponent(e)) // Then encode
              .join(",");

             if (encodedTo) { // Ensure there's at least one valid TO address after filtering/encoding
                mailtoLink = `mailto:${encodedTo}?${finalQueryString}`;
             } else {
                mailtoLink = ""; // No valid TO address
                console.error("No valid TO addresses provided after encoding.");
             }

          } else {
            mailtoLink = "";
            console.error("TO address constant is missing or empty.");
          }

          // --- Construct body text for preview/copy (plain text) ---
          copyText = [
              selectedPara1,
              selectedPara2,
              selectedPara3,
              selectedSignoff
          ].filter(p => typeof p === 'string' && p.length > 0)
           .join('\n\n');

          // --- Update preview elements safely ---
          const toElem = document.getElementById("preview-to");
          const ccElem = document.getElementById("preview-cc");
          const ccLine = document.getElementById("cc-line");
          const bccElem = document.getElementById("preview-bcc");
          const bccLine = document.getElementById("bcc-line");
          const subjectElem = document.getElementById("preview-subject");
          const previewElem = document.getElementById("email-preview");

          if (toElem) toElem.textContent = escapeHtmlForDisplay(TO_ADDRESS || '(Not specified)');
          if (ccElem && ccLine) {
              if (CC_ADDRESS) {
                  ccElem.textContent = escapeHtmlForDisplay(CC_ADDRESS);
                  ccLine.style.display = 'block';
              } else {
                  ccLine.style.display = 'none';
              }
          }
          if (bccElem && bccLine) {
              if (BCC_ADDRESS) {
                  bccElem.textContent = escapeHtmlForDisplay(BCC_ADDRESS);
                  bccLine.style.display = 'block';
              } else {
                  bccLine.style.display = 'none';
              }
          }
          // Display generated subject or placeholder
          if (subjectElem) subjectElem.textContent = escapeHtmlForDisplay(selectedSubject || '(No subject generated)');
          // Display generated body or placeholder
          if (previewElem) previewElem.textContent = copyText || '(No body content generated)';


          // --- Update the href of the anchor tag ---
          if (sendLink) {
            if (mailtoLink) {
              sendLink.href = mailtoLink;
              sendLink.classList.remove("disabled");
              sendLink.title = "Click to open in your default email client";
            } else {
              sendLink.href = "#"; // Prevent navigation
              sendLink.classList.add("disabled"); // Visually disable
              sendLink.title = "Cannot generate email link (check TO address and console errors)";
            }
          }
        } catch (err) {
          console.error("Error in prepareMail:", err);
          alert("An error occurred while preparing the email preview. Check console for details.");
          if (sendLink) {
            sendLink.href = "#";
            sendLink.classList.add("disabled");
            sendLink.title = "Error generating email link";
          }
        }
      }

      // --- Event Listeners within generated file ---
      document.addEventListener("DOMContentLoaded", () => {
        const copyButton = document.getElementById("copy");

        if (copyButton) {
          copyButton.addEventListener("click", () => {
            // Ensure content exists before trying to copy
            if (!copyText && !selectedSubject) {
              alert("Email content not generated yet. Please reload or check generator inputs.");
              return;
            }
            // Construct the full text including headers for copying
            const fullEmailText = `To: ${TO_ADDRESS || ''}\n${
              CC_ADDRESS ? `Cc: ${CC_ADDRESS}\n` : ""
            }${
              BCC_ADDRESS ? `Bcc: ${BCC_ADDRESS}\n` : ""
            }Subject: ${selectedSubject || ''}\n\n${copyText || ''}`;

            navigator.clipboard.writeText(fullEmailText)
              .then(() => {
                alert("Email content copied to clipboard!");
              })
              .catch(err => {
                console.warn("Clipboard API failed, trying fallback:", err);
                // Fallback using temporary textarea
                const textarea = document.createElement("textarea");
                textarea.value = fullEmailText;
                textarea.style.position = "fixed"; // Prevent scrolling issues
                textarea.style.opacity = "0"; // Hide it visually
                textarea.style.left = "-9999px"; // Move off-screen
                document.body.appendChild(textarea);
                textarea.select();
                try {
                  document.execCommand("copy");
                  alert("Email content copied (fallback)!");
                } catch (errFallback) {
                  console.error("Fallback copy failed:", errFallback);
                  alert("Failed to copy automatically. Please copy manually from the preview.");
                }
                document.body.removeChild(textarea);
              });
          });
        }

        // Initial preparation on load
        prepareMail();

        // Automatically redirect to a mail app
        const sendLink = document.getElementById("send");
        if (sendLink && !sendLink.classList.contains("disabled")) {
          window.location.href = sendLink.href;
        }
      });
    
      // --- Embedded Mail Generation Script END ---
    </script>
</body>
</html>